{% extends "_base.html" %}
{% load i18n %}
{% load static %}
{% load humanize %}

{% block title %}{% trans "Settings" %}{% endblock title %}

{% block content %}
<h2 class="mb-4 mt-5">{% trans "Settings" %}</h2>

<h3>{% trans "Change Password" %}</h3>
<p class="text-muted mb-3">{% trans "Update your account password to keep your account secure. Choose a strong password that you haven't used elsewhere." %}</p>
<a class="btn btn-outline-primary" href="{% url 'account_change_password' %}">{% trans "Change Password" %}</a>

<h3 class="mt-5">{% trans "Delete Data" %}</h3>
<p class="text-muted mb-3">{% trans "Your account is connected to" %} {{ user.measurements.count|intcomma }} {% trans "measurements. Do you really want to delete these?" %}</p>
<a class="btn btn-outline-danger" href="{% url 'data-delete' %}">{% trans "Delete Data" %}</a>

<h3 class="mt-5">{% trans "Delete Account" %}</h3>
{% if user.owned_organizations.exists %}
    <div class="alert alert-warning">
        <h5><i class="bi bi-exclamation-triangle me-2"></i>{% trans "Cannot Delete Account" %}</h5>
        <p>{% trans "Your account is currently an owner in these organizations:" %}</p>
        <ul class="list-group list-group-flush mb-3">
            {% for org in user.owned_organizations.all %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <strong>{{ org.name }}</strong>
                        {% if org.description %}
                            <br><small class="text-muted">{{ org.description|truncatewords:10 }}</small>
                        {% endif %}
                    </div>
                    <div>
                        <a href="{% url 'organizations-detail' org.pk %}" class="btn btn-sm btn-outline-primary me-2">
                            <i class="bi bi-eye me-1"></i>{% trans "View" %}
                        </a>
                        <a href="{% url 'organizations-update' org.pk %}" class="btn btn-sm btn-outline-warning">
                            <i class="bi bi-pencil me-1"></i>{% trans "Edit" %}
                        </a>
                    </div>
                </li>
            {% endfor %}
        </ul>
        <p class="mb-0"><strong>{% trans "You must remove yourself, transfer ownership, or delete these organizations before you can delete your user." %}</strong></p>
    </div>
    <button class="btn btn-outline-danger" disabled>
        <i class="bi bi-person-x me-2"></i>{% trans "Delete Account" %}
    </button>
    <small class="form-text text-muted d-block mt-2">
        <i class="bi bi-info-circle me-1"></i>{% trans "The delete account button will be enabled once you are no longer an owner of any organizations." %}
    </small>
{% else %}
    <p>{% trans "You are not an owner of any organizations. You can safely delete your account." %}</p>
    <a class="btn btn-outline-danger" href="{% url 'account-delete' %}">
        <i class="bi bi-person-x me-2"></i>{% trans "Delete Account" %}
    </a>
{% endif %}

{% endblock content %}